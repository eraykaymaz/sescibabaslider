<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>A01–A05 Excel Slider Üretici (FINAL)</title>

<style>
body{font-family:Arial;padding:15px;background:#f7f7f7;}
table{width:100%;border-collapse:collapse;background:#fff;margin-top:15px;font-size:13px;}
th,td{border:1px solid #ccc;padding:6px;text-align:left;}
img{width:70px;height:70px;object-fit:contain;}
.red{background:#ffe3e3;}
.btn{padding:5px 10px;border:0;border-radius:5px;cursor:pointer;font-size:12px;}
.update{background:#1976d2;color:#fff}
.gen{background:#ff7f00;color:#fff}
.input{width:150px;padding:4px}
.git{color:#0d47a1;font-weight:bold}
</style>
</head>
<body>

<h2>A01–A05 Excel → 15 Ürünlük Slider Üretici</h2>

<input type="file" id="excelFile" accept=".xlsx">

<table id="productTable">
<thead>
<tr>
  <th>Görsel</th>
  <th>Başlık</th>
  <th>Fiyat</th>
  <th>Kategori</th>
  <th>A-Kodu</th>
  <th>Link</th>
  <th>Üret</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script>
/* ==========================================
   A01–A05 RELATED MAP (15 ürün çıkarır)
========================================== */
const CATEGORY_MAP = {
"A01":["A02","A03","A04","A05","A06","A07","A08","A09","A10","A11","A12","A13","A14","A15","A01"],
"A02":["A03","A04","A05","A06","A07","A08","A09","A10","A11","A12","A13","A14","A15","A01","A02"],
"A03":["A04","A05","A06","A07","A08","A09","A10","A11","A12","A13","A14","A15","A01","A02","A03"],
"A04":["A05","A06","A07","A08","A09","A10","A11","A12","A13","A14","A15","A01","A02","A03","A04"],
"A05":["A06","A07","A08","A09","A10","A11","A12","A13","A14","A15","A01","A02","A03","A04","A05"]
};

let PRODUCTS = {};   // { A01:['link'], ... }

/* ==========================================
   EXCEL OKUMA
========================================== */
document.getElementById("excelFile").addEventListener("change", async (e)=>{
  const file=e.target.files[0];
  const data=await file.arrayBuffer();
  const wb=XLSX.read(data);
  const sheet=wb.Sheets[wb.SheetNames[0]];
  const rows=XLSX.utils.sheet_to_json(sheet,{header:1});
  const body=document.querySelector("#productTable tbody");
  body.innerHTML="";

  for(let i=1;i<rows.length;i++){
    let catName=rows[i][0];
    let CODE=rows[i][1];
    let LINK=rows[i][2];

    if(!CODE) continue;

    if(!PRODUCTS[CODE]) PRODUCTS[CODE]=[];
    if(LINK) PRODUCTS[CODE][0]=LINK;

    let api = LINK ? await fetchAPI(LINK) : {title:"-",image:"",price:"-",stock:"YOK"};

    body.appendChild(renderRow(i,catName,CODE,LINK,api));
  }
});

/* ==========================================
   TABLO SATIRI
========================================== */
function renderRow(i,catName,CODE,LINK,api){
  const tr=document.createElement("tr");
  if(api.stock==="YOK") tr.classList.add("red");

  tr.innerHTML=`
    <td><img src="${api.image}"></td>
    <td>${api.title}</td>
    <td>${api.price}</td>
    <td>${catName}</td>
    <td>${CODE}</td>
    <td class="cell">
      ${LINK ? `<a href="${LINK}" class="git" target="_blank">Git</a>` :
      `<input id="inp_${i}" class="input" placeholder="Link">
       <button class="btn update" onclick="updateLink(${i},'${CODE}')">OK</button>`}
    </td>
    <td><button class="btn gen" onclick="generateSlider('${CODE}')">ÜRET</button></td>
  `;

  return tr;
}

/* ==========================================
   LİNK GÜNCELLE
========================================== */
async function updateLink(i,CODE){
  const newLink=document.getElementById("inp_"+i).value.trim();
  if(!newLink) return;

  PRODUCTS[CODE]=[newLink];

  const api=await fetchAPI(newLink);

  const row=document.getElementById("inp_"+i).closest("tr");
  row.children[0].innerHTML=`<img src="${api.image}">`;
  row.children[1].innerHTML=api.title;
  row.children[2].innerHTML=api.price;
  row.children[5].innerHTML=`<a href="${newLink}" class="git" target="_blank">Git</a>`;
  row.classList.toggle("red", api.stock==="YOK");
}

/* ==========================================
   API ÇEKME
========================================== */
async function fetchAPI(url){
  try{
    const r=await fetch(
      "https://yellow-fog-3fba.eray-kaymaz.workers.dev/?url="+encodeURIComponent(url)
    );
    return await r.json();
  }catch{
    return {title:"-",price:"-",image:"",stock:"YOK"};
  }
}

/* ==========================================
   SLIDER ÜRET (15 ÜRÜN)
========================================== */
async function generateSlider(CODE){
  const related=CATEGORY_MAP[CODE] || [];
  let items=[];

  for(const rc of related){
    const link=PRODUCTS[rc]?.[0];
    if(!link) continue;

    const api=await fetchAPI(link);
    items.push({...api,link});
    if(items.length===15) break;
  }

  const html = sliderHTML(items);
  const blob=new Blob([html],{type:"text/html"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=CODE+"-slider.html";
  a.click();
}

/* ==========================================
   3D HOVERLI – OK TUŞLU – AUTO SLIDE
   T-SOFT UYUMLU SLIDER TEMPLATE
========================================== */
function sliderHTML(items){
return `
<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Slider</title>

<style>
body{margin:0;padding:0;font-family:Arial;background:#fff;}
.wrap{width:100%;overflow:hidden;position:relative;padding:25px 0;}
.slider{display:flex;gap:18px;padding:10px 20px;overflow-x:auto;scroll-behavior:smooth;}
.slider::-webkit-scrollbar{display:none}

/* CARD */
.item{
  width:170px;
  min-width:170px;
  height:350px;
  padding:12px;
  background:#fff;
  border-radius:14px;
  box-shadow:0 2px 6px rgba(0,0,0,.12);
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  cursor:pointer;
  transition:.25s;
  text-align:center;
}
.item:hover{
  transform:translateY(-4px);
  box-shadow:0 6px 18px rgba(0,0,0,.25);
}

.item img{
  width:150px;
  height:150px;
  object-fit:contain;
  margin:auto;
  transition:.25s;
}
.item:hover img{ transform:scale(1.07); }

.title{
  font-size:14px;
  font-weight:700;
  line-height:18px;
  height:36px;
  overflow:hidden;
  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
}

.price{font-size:18px;font-weight:900;color:#c00;margin-top:8px;}
.price.out{color:#bd6b68;}
.tukendi{font-size:13px;color:#b69495;font-weight:700;margin-top:3px;}

.btn{
  margin-top:auto;
  padding:9px 0;
  border-radius:8px;
  font-size:13px;
  font-weight:700;
}

.btn.add{
  background:#d54c5a;
  color:#fff;
}
.btn.disabled{
  background:#ccc;
  color:#666;
  cursor:not-allowed;
}

/* OKLAR */
.arrow{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  width:42px;
  height:42px;
  background:#fff;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:24px;
  cursor:pointer;
  box-shadow:0 2px 10px rgba(0,0,0,.25);
  z-index:20;
}
.left{left:5px}
.right{right:5px}

@media(max-width:768px){ .arrow{display:none;} }
</style>
</head>

<body>

<div class="wrap">
  <div class="arrow left">❮</div>
  <div class="arrow right">❯</div>

  <div class="slider" id="slider">

${items.map(p=>`
  <div class="item" onclick="go('${p.link}')">
    <img src="${p.image}">
    <div class="title">${p.title}</div>

    ${p.stock==="YOK"
      ? `<div class="price out">${p.price}</div>
         <div class="tukendi">Tükendi</div>
         <div class='btn disabled'>Sepete Ekle</div>`
      : `<div class="price">${p.price}</div>
         <div class='btn add' onclick="cart('${p.id || ""}');event.stopPropagation();">Sepete Ekle</div>`}
  </div>
`).join("")}

  </div>
</div>

<script>
// Ürüne git
function go(url){ window.top.location.href=url; }

// Sepete ekle
function cart(id){
  if(!id) return;
  window.top.location.href = "?add-to-cart="+id;
}

// Auto slide
let slider=document.getElementById("slider");
let auto=true;
function autoScroll(){
  if(auto) slider.scrollBy({left:200,behavior:"smooth"});
}
let timer=setInterval(autoScroll,2500);

function stopAuto(){
  auto=false;
  clearTimeout(window.resume);
  window.resume=setTimeout(()=>auto=true,6000);
}

document.querySelector(".left").onclick=()=>{ slider.scrollBy({left:-200,behavior:"smooth"}); stopAuto(); };
document.querySelector(".right").onclick=()=>{ slider.scrollBy({left:200,behavior:"smooth"}); stopAuto(); };

slider.addEventListener("touchstart", stopAuto);
</script>

</body>
</html>
`;
}
</script>

</body>
</html>
