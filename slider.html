<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sescibaba Akıllı Slider</title>

<style>
body { margin: 0; padding: 0; background: #fff; font-family: Arial; }

.slider-wrap { overflow: hidden; width: 100%; max-width: 1850px; margin: 0 auto; position: relative; }
.slider-track { display: flex; gap: 18px; transition: transform .5s; }
.slide-item { width: 150px; text-align: center; padding: 20px 0; }
.slide-item img { width: 150px; height: 150px; object-fit: contain; border-radius: 12px; }

.product-title { font-size: 14px; font-weight: 700; margin-top: 10px; }
.product-price { font-size: 15px; font-weight: 800; color: #d30000; margin-top: 4px; }

.slider-arrow {
  position: absolute; top: 45%; transform: translateY(-50%);
  background: rgba(255,255,255,.9); border: none;
  width: 40px; height: 40px; border-radius: 50%; cursor: pointer;
  font-size: 22px; box-shadow: 0 0 6px rgba(0,0,0,.25);
}

.slider-prev { left: 5px; }
.slider-next { right: 5px; }

.slider-divider {
  width: 92%; height: 2px;
  margin: 10px auto 40px;
  background: linear-gradient(to right, transparent, rgba(0,0,0,.15), transparent);
}
</style>
</head>

<body>

<div class="slider-wrap" id="sliderWrap">
  <button class="slider-arrow slider-prev">❮</button>
  <div class="slider-track" id="sliderTrack"></div>
  <button class="slider-arrow slider-next">❯</button>
</div>

<div class="slider-divider"></div>

<script>
function loadScript(src){
  return new Promise((resolve,reject)=>{
    const s=document.createElement("script");
    s.src = src + "?v=" + Date.now();
    s.onload = resolve;
    s.onerror = reject;
    document.body.appendChild(s);
  });
}

const getParam = (k)=> new URLSearchParams(location.search).get(k);

async function loadSlider(){
  const CAT = getParam("cat") || "CAT001";

  await loadScript("data/category-map.js");
  await loadScript("data/products.js");

  const map = window.CATEGORY_MAP;
  const pro = window.PRODUCTS;

  if (!map[CAT]) { console.error("CAT bulunamadı:", CAT); return; }

  const related = map[CAT].related;   // DÜZELTME: related dizisi
  const track = document.getElementById("sliderTrack");

  for (let sub of related){
    const productLink = pro[sub]?.[0];
    if (!productLink) continue;

    const api = await fetch("https://yellow-fog-3fba.eray-kaymaz.workers.dev/?url="+encodeURIComponent(productLink)).then(r=>r.json());

    const t = api.title.split(" ");
    const line1 = t.slice(0,3).join(" ");
    const line2 = t.slice(3,6).join(" ");

    let div = document.createElement("div");
    div.className = "slide-item";
    div.innerHTML = `
      <a href="${productLink}" target="_top">
        <img src="${api.image}">
      </a>
      <div class="product-title">${line1}<br>${line2}</div>
      <div class="product-price">${api.price}</div>
    `;
    track.appendChild(div);
  }

  initSlider();
}

function initSlider(){
  const track = document.getElementById("sliderTrack");
  const slides = [...track.children];
  if (slides.length === 0) return;

  const next = document.querySelector(".slider-next");
  const prev = document.querySelector(".slider-prev");
  let index = 0;
  let slideWidth = slides[0].offsetWidth + 18;

  const goTo = (i)=> track.style.transform = `translateX(-${i * slideWidth}px)`;

  next.onclick = ()=>{ index++; if(index >= slides.length-8) index=0; goTo(index); };
  prev.onclick = ()=>{ index--; if(index < 0) index = slides.length-8; goTo(index); };
}

loadSlider();
</script>
</body>
</html>
