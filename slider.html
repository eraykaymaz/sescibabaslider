<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sescibaba Akıllı Slider</title>

<style>
body {
  margin: 0;
  padding: 0;
  background: #fff;
  font-family: Arial, sans-serif;
}

/* SLIDER */
.slider-wrap { overflow:hidden; width:100%; max-width:1850px; margin:0 auto; position:relative; }
.slider-track { display:flex; gap:18px; transition:transform .5s ease-in-out; }
.slide-item { width:150px; text-align:center; padding:20px 0; }

/* IMAGE */
.slide-item img {
  width:150px; height:150px; object-fit:contain;
  border-radius:12px; background:#fff; transition:.3s;
}
.slide-item:hover img {
  transform:scale(1.08);
  box-shadow:0 4px 14px rgba(0,0,0,.25);
}

/* TITLE */
.product-title { font-size:14px; font-weight:700; color:#000; margin-top:10px; line-height:16px; }

/* PRICE */
.product-price {
  font-size:15px;
  font-weight:800;
  color:#d30000;
  margin-top:4px;
}

/* TÜKENDİ */
.out-stock {
  margin-top:6px;
  font-size:14px;   /* 1 punto küçültüldü */
  font-weight:700;
  color:#999;       /* gri */
}

/* SEPETE EKLE BUTTON */
.add-cart-btn {
  margin-top:8px;
  width:130px;
  background:#d54c5a;
  padding:8px 0;
  border-radius:8px;
  border:none;
  color:white;
  font-weight:700;
  cursor:pointer;
  transition:.25s;
}
.add-cart-btn:hover {
  background:#c43745;
}

/* ARROWS */
.slider-arrow {
  position:absolute; top:45%; transform:translateY(-50%);
  background:#fff; border:0; width:40px; height:40px;
  border-radius:50%; box-shadow:0 0 6px rgba(0,0,0,.25);
  cursor:pointer; font-size:22px;
}
.slider-prev { left:5px; }
.slider-next { right:5px; }

/* DIVIDER */
.slider-divider {
  width:92%; height:2px;
  background:linear-gradient(to right, transparent, rgba(0,0,0,0.15), transparent);
  margin:10px auto 40px;
  border-radius:2px;
}
</style>
</head>

<body>

<div class="slider-wrap">
  <button class="slider-arrow slider-prev">❮</button>
  <div class="slider-track" id="sliderTrack"></div>
  <button class="slider-arrow slider-next">❯</button>
</div>

<div class="slider-divider"></div>

<script>
/* SCRIPT LOADING */
function loadScript(src){
  return new Promise((resolve,reject)=>{
    const s=document.createElement("script");
    s.src = src+"?v="+Date.now();
    s.onload=resolve; s.onerror=reject;
    document.body.appendChild(s);
  });
}

const getParam = key => new URLSearchParams(location.search).get(key);

/* FİYAT FORMATLAYICI — TL HER ZAMAN SAĞDA */
function formatPrice(price){
  if (!price) return "";

  // sadece rakamdan oluşuyorsa TL
  if (/^[0-9.]+$/.test(price)) return price + " ₺";

  // US Dollar formatı (virgüllü fiyat)
  if (price.includes(",")) return price + " $";

  // EURO
  return price + " €";
}

/* SLIDER DATA LOAD */
async function loadSlider(){
  const CAT = getParam("cat") || "CAT001";

  await loadScript("data/category-map.js");
  await loadScript("data/products.js");

  const map  = window.CATEGORY_MAP;
  const pro  = window.PRODUCTS;
  const list = map[CAT].related;

  const track = document.getElementById("sliderTrack");

  for (let rc of list){
    const link = pro[rc]?.[0];
    if (!link) continue;

    const api = await fetch(
      "https://yellow-fog-3fba.eray-kaymaz.workers.dev/?url=" + encodeURIComponent(link)
    ).then(r=>r.json());

    const div = document.createElement("div");
    div.className = "slide-item";

    const priceHTML = 
      api.stock === "YOK"
      ? `<div class="out-stock">Tükendi</div>`
      : `
         <div class="product-price">${formatPrice(api.price)}</div>
         <button class="add-cart-btn" onclick="addToCart('${link}')">Sepete Ekle</button>
        `;

    div.innerHTML = `
      <a href="${link}" target="_top"><img src="${api.image}"></a>
      <div class="product-title">${api.title}</div>
      ${priceHTML}
    `;

    track.appendChild(div);
  }

  initSlider();
}

/* ADD TO CART */
function addToCart(link){
  window.top.location.href = link + "?add-to-cart=1";
}

/* SLIDER MOTORU */
function initSlider(){
  const track  = document.getElementById("sliderTrack");
  const slides = [...track.children];
  let index = 0;
  const slideWidth = 168;

  function go(i){
    track.style.transform = "translateX(-" + (i*slideWidth) + "px)";
  }

  document.querySelector(".slider-next").onclick = ()=>{
    index++;
    if(index >= slides.length - 8) index = 0;
    go(index);
  };

  document.querySelector(".slider-prev").onclick = ()=>{
    index--;
    if(index < 0) index = slides.length - 8;
    go(index);
  };
}

loadSlider();
</script>

</body>
</html>
