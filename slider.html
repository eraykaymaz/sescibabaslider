<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sescibaba Akıllı Slider</title>

<style>
body {
  margin: 0;
  padding: 0;
  background: #fff;
  font-family: Arial, sans-serif;
}

/* SLIDER WRAPPER */
.slider-wrap {
  overflow: hidden;
  width: 100%;
  max-width: 1850px;
  margin: 0 auto;
  position: relative;
}

/* TRACK */
.slider-track {
  display: flex;
  gap: 18px;
  transition: transform 0.5s ease-in-out;
  touch-action: pan-y;
}

/* ITEM */
.slide-item {
  flex: 0 0 auto;
  width: 150px;
  text-align: center;
  padding: 20px 0;
  box-sizing: border-box;
}

/* GÖRSEL */
.slide-item img {
  width: 150px;
  height: 150px;
  object-fit: contain;
  border-radius: 12px;
  background: #fff;
  transition: transform .3s ease, box-shadow .3s ease;
}

@media (hover:hover) {
  .slide-item:hover img {
    transform: scale(1.08);
    box-shadow: 0 4px 14px rgba(0,0,0,.25);
  }
}

/* ÜRÜN ADI */
.product-title {
  font-size: 14px;
  font-weight: 700;
  color: #000;
  margin-top: 10px;
  line-height: 16px;
}

/* FİYAT */
.product-price {
  font-size: 15px;
  font-weight: 800;
  color: #d30000;
  margin-top: 4px;
}

/* OKLAR */
.slider-arrow {
  position: absolute;
  top: 45%;
  transform: translateY(-50%);
  background: rgba(255,255,255,.9);
  border: none;
  font-size: 22px;
  cursor: pointer;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  box-shadow: 0 0 6px rgba(0,0,0,.25);
  z-index: 20;
  transition: background .3s, transform .2s;
}

.slider-arrow:hover {
  background: rgba(0,0,0,.15);
  transform: translateY(-50%) scale(1.1);
}

.slider-prev { left: 5px; }
.slider-next { right: 5px; }

@media(max-width:768px){
  .slider-arrow{display:none}
  .slide-item{width:120px;}
  .slider-track{gap:14px;}
}

/* ALT 3D AYRAÇ */
.slider-divider {
  width: 92%;
  height: 2px;
  background: linear-gradient(to right, transparent, rgba(0,0,0,0.15), transparent);
  margin: 10px auto 40px;
  border-radius: 2px;
}
</style>
</head>

<body>

<div class="slider-wrap" id="sliderWrap">
  <button class="slider-arrow slider-prev">❮</button>
  <div class="slider-track" id="sliderTrack"></div>
  <button class="slider-arrow slider-next">❯</button>
</div>

<div class="slider-divider"></div>

<script>
/* external JS dosyalarını yükleyen fonksiyon */
function loadScript(src){
  return new Promise((resolve, reject)=>{
    const s = document.createElement("script");
    s.src = src + "?v=" + Date.now(); // cache sorunu olmasın
    s.onload = resolve;
    s.onerror = reject;
    document.body.appendChild(s);
  });
}

// URL param al
const getParam = (key) => new URLSearchParams(location.search).get(key);

async function loadSlider() {
  const CAT = getParam("cat") || "CAT001";

  /* ❗ ARTIK JSON DEĞİL JS DOSYASI YÜKLENİYOR */
  await loadScript("data/category-map.js");
  await loadScript("data/products.js");

  const map = window.CATEGORY_MAP;
  const pro = window.PRODUCTS;

  const relatedCats = map[CAT];
  const track = document.getElementById("sliderTrack");

  for (let rc of relatedCats) {
    const productLink = pro[rc][0];
    if (!productLink) continue;

    // canlı API
    const api = await fetch(
      "https://yellow-fog-3fba.eray-kaymaz.workers.dev/?url=" +
      encodeURIComponent(productLink)
    ).then(r=>r.json());

    const div = document.createElement("div");
    div.className = "slide-item";

    const titleWords = api.title.split(" ");
    const line1 = titleWords.slice(0,3).join(" ");
    const line2 = titleWords.slice(3,6).join(" ");

    div.innerHTML = `
      <a href="${productLink}" target="_top">
        <img src="${api.image}">
      </a>
      <div class="product-title">
        ${line1}<br>${line2}
      </div>
      <div class="product-price">${api.price}</div>
    `;

    track.appendChild(div);
  }

  initSlider();
}

function initSlider() {
  const track = document.getElementById("sliderTrack");
  const slides = Array.from(track.children);
  const next = document.querySelector(".slider-next");
  const prev = document.querySelector(".slider-prev");
  const totalSlides = slides.length;

  let slideWidth;
  let visibleCount;
  let index = 0;
  let paused = false;
  let autoPlay;
  let restartTimer;

  function updateSizes() {
    slideWidth = slides[0].offsetWidth + 18;
    visibleCount = window.innerWidth < 768
      ? Math.floor(window.innerWidth / (slideWidth + 5))
      : 8;
  }

  function goTo(i) {
    track.style.transform = `translateX(-${i * slideWidth}px)`;
  }

  function start() {
    autoPlay = setInterval(()=>{
      if (!paused) {
        index++;
        if (index > totalSlides - visibleCount) index = 0;
        goTo(index);
      }
    }, 2800);
  }

  function pause(temp=false){
    clearInterval(autoPlay);
    if (temp){
      clearTimeout(restartTimer);
      restartTimer = setTimeout(()=>start(), 3000);
    }
  }

  updateSizes();
  start();

  if (window.matchMedia("(hover:hover)").matches) {
    sliderWrap.addEventListener("mouseenter", ()=>paused=true);
    sliderWrap.addEventListener("mouseleave", ()=>paused=false);
  }

  next.onclick = ()=>{ pause(true); index++; if(index > totalSlides-visibleCount) index=0; goTo(index); };
  prev.onclick = ()=>{ pause(true); index--; if(index < 0) index = totalSlides-visibleCount; goTo(index); };

  window.addEventListener("resize", ()=>{ updateSizes(); goTo(index); });
}

loadSlider();
</script>

</body>
</html>
