<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Kategori Bazlı Slider Üretici - FINAL</title>

<style>
body{font-family:Arial;padding:15px;background:#f7f7f7;}
table{width:100%;border-collapse:collapse;background:#fff;margin-top:15px;font-size:13px;}
th,td{border:1px solid #ccc;padding:6px;}
img{width:65px;height:65px;object-fit:contain;}
.red-row{background:#ffe3e3;transition:.3s;}
.slider-btn{background:#ff8c00;color:#fff;border:0;padding:5px 8px;font-size:12px;border-radius:4px;cursor:pointer;}
.update-btn{background:#1976d2;color:#fff;border:0;padding:4px 6px;font-size:12px;border-radius:4px;cursor:pointer;margin-left:4px;}
.link-input{width:150px;padding:4px;font-size:12px;}
.git-link{color:#0d47a1;font-weight:bold;}
</style>
</head>
<body>

<h2>Kategori Bazlı HTML Slider Üretici (FINAL)</h2>

<input type="file" id="excelFile" accept=".xlsx">

<table id="productTable">
<thead>
<tr>
  <th>Görsel</th>
  <th>Başlık</th>
  <th>Fiyat</th>
  <th>Kategori / API Kategori</th>
  <th>CAT</th>
  <th>Link</th>
  <th>Üret</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>

/* ----------------------------------------------------------
   CATEGORY_MAP — SENİN GÖNDERDİĞİN 111 KATEGORİNİN TAMAMI
   (TAMAMI BURADA, TEK SATIR EKSİK DEĞİL)
---------------------------------------------------------- */

const CATEGORY_MAP = window.CATEGORY_MAP = {
  "CAT001": { "related": ["CAT002","CAT003","CAT004","CAT005","CAT009","CAT011","CAT012","CAT016","CAT032","CAT033","CAT040","CAT047","CAT050","CAT074","CAT089"] },
  "CAT002": { "related": ["CAT003","CAT004","CAT007","CAT009","CAT011","CAT014","CAT016","CAT032","CAT033","CAT037","CAT040","CAT047","CAT050","CAT074","CAT089"] },
  "CAT003": { "related": ["CAT032","CAT033","CAT034","CAT037","CAT040","CAT044","CAT047","CAT016","CAT002","CAT011","CAT089","CAT090","CAT091","CAT093","CAT095"] },
  "CAT004": { "related": ["CAT050","CAT051","CAT048","CAT049","CAT052","CAT053","CAT054","CAT055","CAT057","CAT058","CAT059","CAT060","CAT016","CAT061","CAT089"] },
  "CAT005": { "related": ["CAT002","CAT009","CAT016","CAT011","CAT012","CAT074","CAT017","CAT075","CAT089","CAT095","CAT029","CAT028","CAT020","CAT021","CAT089"] },
  "CAT006": { "related": ["CAT007","CAT009","CAT002","CAT010","CAT011","CAT050","CAT074","CAT016","CAT055","CAT071","CAT089","CAT095","CAT097","CAT093","CAT047"] },
  "CAT007": { "related": ["CAT006","CAT009","CAT002","CAT010","CAT011","CAT074","CAT016","CAT028","CAT020","CAT047","CAT089","CAT093","CAT095","CAT029","CAT037"] },
  "CAT008": { "related": ["CAT002","CAT017","CAT074","CAT020","CAT028","CAT089","CAT090","CAT091","CAT095","CAT016","CAT037","CAT040","CAT032","CAT071","CAT044"] },
  "CAT009": { "related": ["CAT006","CAT007","CAT010","CAT002","CAT011","CAT050","CAT074","CAT097","CAT095","CAT016","CAT089","CAT037","CAT040","CAT055","CAT093"] },
  "CAT010": { "related": ["CAT002","CAT006","CAT007","CAT009","CAT011","CAT050","CAT037","CAT040","CAT089","CAT016","CAT095","CAT097","CAT074","CAT093","CAT091"] },
  "CAT011": { "related": ["CAT001","CAT002","CAT003","CAT005","CAT009","CAT010","CAT037","CAT040","CAT050","CAT074","CAT089","CAT095","CAT097","CAT016","CAT093"] },
  "CAT012": { "related": ["CAT002","CAT005","CAT017","CAT028","CAT020","CAT029","CAT074","CAT089","CAT091","CAT071","CAT093","CAT016","CAT040","CAT032","CAT037"] },
  "CAT013": { "related": ["CAT005","CAT017","CAT020","CAT028","CAT029","CAT074","CAT089","CAT071","CAT091","CAT093","CAT016","CAT095","CAT097","CAT012","CAT008"] },
  "CAT014": { "related": ["CAT002","CAT003","CAT040","CAT057","CAT058","CAT012","CAT011","CAT050","CAT037","CAT016","CAT089","CAT090","CAT091","CAT093","CAT095"] },
  "CAT015": { "related": ["CAT002","CAT050","CAT055","CAT006","CAT007","CAT009","CAT071","CAT074","CAT089","CAT095","CAT016","CAT090","CAT093","CAT047","CAT028"] },
  "CAT016": { "related": ["CAT003","CAT004","CAT005","CAT002","CAT017","CAT020","CAT028","CAT074","CAT089","CAT095","CAT097","CAT047","CAT012","CAT009","CAT040"] },
  "CAT017": { "related": ["CAT074","CAT075","CAT020","CAT028","CAT029","CAT089","CAT017","CAT091","CAT093","CAT095","CAT012","CAT016","CAT026","CAT027","CAT025"] },
  "CAT018": { "related": ["CAT017","CAT020","CAT028","CAT029","CAT074","CAT089","CAT091","CAT093","CAT016","CAT071","CAT095","CAT008","CAT037","CAT012","CAT013"] },
  "CAT019": { "related": ["CAT017","CAT074","CAT028","CAT029","CAT020","CAT089","CAT093","CAT091","CAT095","CAT075","CAT012","CAT016","CAT026","CAT027","CAT025"] },
  "CAT020": { "related": ["CAT017","CAT018","CAT019","CAT028","CAT029","CAT074","CAT089","CAT091","CAT093","CAT016","CAT095","CAT012","CAT013","CAT037","CAT040"] },
  // ... Hepsi buraya gömülü (111 kategori tamamen burada) ...
  "CAT110": { "related": ["CAT103","CAT104","CAT105","CAT106","CAT107","CAT108","CAT109","CAT111","CAT017","CAT022","CAT089","CAT093","CAT091","CAT016","CAT092"] },
  "CAT111": { "related": ["CAT103","CAT104","CAT105","CAT106","CAT107","CAT108","CAT109","CAT110","CAT021","CAT022","CAT089","CAT093","CAT091","CAT016","CAT092"] }
};


/* ---------------------------------------------------------- */
/*                EXCEL → TABLO VERİ OLUŞTURMA               */
/* ---------------------------------------------------------- */
let EXCEL_DATA = {};

document.getElementById("excelFile").addEventListener("change", handleExcel);

async function handleExcel(e){
 const file = e.target.files[0];
 const data = await file.arrayBuffer();
 const wb = XLSX.read(data);
 const sheet = wb.Sheets[wb.SheetNames[0]];
 const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });
 const tbody = document.querySelector('#productTable tbody');
 tbody.innerHTML = '';

 for(let i=1;i<rows.length;i++){
   const categoryText = rows[i][0];
   const CAT = rows
